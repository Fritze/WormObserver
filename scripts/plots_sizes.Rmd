#set parameters here
```{r, include=FALSE}

#Set the location folder of the raw data (of all experiments you want to plot)
base_path <- "/media/fpreuss/raid5/timelapses/analysis/200703/"

```

#load files
```{r, include=FALSE}

target_path <- file.path(base_path,"data")
save_path <- file.path(base_path,"plots")

#list of .rds files in data folder
files_to_process <- list.files(target_path, "raw_data.rds", full.names = TRUE, ignore.case = TRUE)

#select dataset
files_to_process <- grep(".+L3.+", files_to_process,value=TRUE)



imported_data <- NULL
#load all .rds files and append to one data frame ('imported_data')
for (file in files_to_process){
  imported_data_temp <- readRDS(file) %>%
    #calculate average size, major and minor axis BY TRACK
    group_by(annotation,dataset_ID, tp,minutes,TrackID) %>%
    summarise(size=mean(Size),major=mean(Major),minor=mean(Minor))
  imported_data <- rbind(imported_data, imported_data_temp)  
}

```

#create plots
```{r, include=FALSE}

library("ggridges")

#pixel to µm conversion
#this is with magnifaction 3.2
conversion_factor <- 6.25

for(a in unique(imported_data$annotation)){
  # new data frame with hours rounded by hour
  data_to_plot <- imported_data %>%
    filter(annotation == a) %>%
    mutate(hours = minutes / 60) %>%
    mutate(hours_rounded= round(hours)) %>%
    filter(hours_rounded <= 14) %>%
    mutate(major = conversion_factor * major, minor = conversion_factor * minor)
  

  #all datasets individually,per annotation
  ggplot(data_to_plot,aes(x = major ,y = factor(as.character(hours_rounded), level = unique(hours_rounded)), fill=stat(x))) +
    geom_density_ridges_gradient(scale = 1) +
    facet_wrap(vars(annotation,dataset_ID),ncol=1,scales="free_x")+
    scale_x_continuous(breaks=seq(0,600, by=100),limits = c(0, max(data_to_plot$major)))+
    scale_fill_viridis()+
    theme_classic()+
    labs(x="Major axis (µm)",y="time (hours)")+
    theme(strip.background = element_rect(colour = "white", fill = "white"),
      strip.text.x = element_text(size=20,colour = "black", face = "bold"),
      axis.text.x = element_text(size=15, face="bold"),
      axis.title.x = element_text(size=20, face="bold"),
      axis.text.y = element_text(size=15, face="bold"),
      axis.title.y = element_text(size=20, face="bold"),
      axis.line = element_line(colour = 'black', size = 1.2),
      axis.ticks = element_line(colour = "black", size = 1.2))+
    ggsave(file.path(save_path,paste0("size_plots_individual_",a,".png")),height=15,width=7.5)
  
  # ggplot(data_to_plot,aes(x = factor(as.character(hours_rounded), level = unique(hours_rounded)) ,y = major)) +
  #   geom_boxplot()
  
}
  
#all annotations grouped
data_to_plot <- imported_data %>%
  mutate(hours = minutes / 60) %>%
  mutate(hours_rounded= floor(hours * 2) / 2)

ggplot(data_to_plot,aes(x = size ,y = factor(as.character(hours_rounded), level = unique(hours_rounded)), fill=stat(x))) +
  geom_density_ridges_gradient(scale = 1) +
  facet_wrap(vars(annotation),ncol=3,scales="free")+
  scale_fill_viridis()+
  labs(x="Size (px)",y="time (hours)")+
  theme_linedraw()+
      theme(strip.background = element_rect(colour = "white", fill = "white"),
      strip.text.x = element_text(size=25,colour = "black", face = "bold"),
      axis.text.x = element_text(size=20),
      axis.title.x = element_text(size=25),
      axis.text.y = element_text(size=20),
      axis.title.y = element_text(size=25))+
  ggsave(file.path(save_path,paste0("size_plots_per_annotation",".png")),height=40,width=40)

```
