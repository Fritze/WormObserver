---
title: "Untitled"
output: html_document
---

```{r, include=FALSE}
library(ggrepel)
# plot_image_with_path(which_tracks,which_track,offset,binning_factor,conversion_factor,time_input_type,time_input,which_dataset,max_number_gaps,duration,selected_frame,color_path,image)
save_path <- "/home/fpreuss/raid/timelapses/analysis/200318/plots/posture/moving_skeletons/"


data_for_plotting <- data %>%

all_frames <- data_for_plotting %>%
  group_by(frame) %>%
  distinct(frame) %>%
  pull(frame) %>%
  sort()

all_tps <- data_for_plotting %>%
  group_by(tp) %>%
  distinct(tp) %>%
  pull(tp) %>%
  sort()

for (t in all_tps){
  data_for_plotting_temp <- data_for_plotting %>%
    filter(tp == t)

  for (i in all_frames){
    ggplot(data_for_plotting_temp)+
        # geom_path(aes(x=location_x, y=location_y,group=TrackID), linetype = 2,alpha=0.5)+
        theme(legend.position = "none")+
        theme_void()+
        theme(aspect.ratio = 1024/1024)+
        coord_cartesian(ylim=c(0, 1023))+
        scale_x_continuous(expand = c(0, 0), limits= c(0,1023))+
        scale_y_continuous(expand = c(0, 0),trans="reverse", limits= c(1023,0))+
        geom_point(data=filter(data_for_plotting_temp,frame==i),aes(location_x+X,location_y+Y,color=angle),size=0.5)+
        # geom_path(data=filter(data_for_plotting_temp,frame==i),aes(location_x+X,location_y+Y,color=angle,group=TrackID),size=1)+
        geom_point(data=filter(data_for_plotting_temp,frame==i & is_head== "YES"),aes(location_x+X,location_y+Y),color="orange",size=2,shape=17)+
        scale_color_gradient2(low = "deepskyblue", mid = "lavender",
                              high = "deeppink",midpoint=0,limits=c(-1,1),na.value="grey") +
        theme(legend.position = "none")+
        # geom_label_repel(data=filter(data_for_plotting_temp,frame==i & is_head== "YES"),aes(location_x+X,location_y+Y,label = TrackID),
        #           size=2.5,
        #           box.padding   = 0.2, 
        #           point.padding = 0.5,
        #           segment.color = 'grey50'
        #           ) +
        ggtitle(paste0(data_for_plotting_temp$dataset_ID, "_",t)) +
        ggsave(file.path(save_path,paste0("Moving_skeletons_dataset_",a_dataset,"_tp_",t,"_frame_",i,".png")),width=6,height=6)
  }
}

```
