```{r, include=FALSE}


#transpose - rows: posture IDs, -columns: angles
angle_data_cluster <- skeleton_data_filtered %>%
  dcast(ID ~ index,value.var = "angle")

angle_data_cluster <- sample_n(angle_data_cluster,100000)

#make IDs the rowname so that this column is not part of the clustering data
rownames(angle_data_cluster) <- angle_data_cluster$ID
angle_data_cluster <- select(angle_data_cluster,-ID)

#take out first and last angle
angle_data_cluster <-angle_data_cluster[,2:(ncol(angle_data_cluster)-1)]

# library(umap)
# umap_cluster <- umap(angle_data_cluster)
umap_cluster <- uwot::umap(angle_data_cluster, min_dist= 0.001,n_neighbors = 100)


        
        
umap_data <- data.frame(umap_cluster) %>%
  mutate(ID = rownames(angle_data_cluster)) %>%
  mutate(tp = as.numeric(gsub(".+\\_(.+)\\_track.+","\\1",ID))) %>%
  mutate(minutes = 10 + ((tp-1)*8+(tp-1)*0)) %>%
  mutate(hours= minutes/60) %>%
  mutate(hours_rounded= ceiling(hours* 2) / 2)
  


ggplot(umap_data, aes(x=X1, y=X2,color=hours_rounded)) +
  geom_point(alpha=0.05)+
  scale_color_viridis()
 
ggplot(umap_data, aes(x=X1, y=X2) ) +
    stat_density_2d(aes(fill = ..density..), geom = "raster", contour = FALSE) +
    scale_fill_distiller(palette=4, direction=1)
    
  
ggplot(umap_data, aes(x=X1, y=X2) ) +
  stat_density_2d(aes(fill = ..density..), geom = "raster", contour = FALSE) +
  scale_fill_distiller(palette= "Spectral", direction=1) +
  scale_x_continuous(limits = c(-10, 10)) +
  scale_y_continuous(limits = c(-10, 10))  +
  ggtitle("ALL")


ggplot(filter(umap_data,hours_rounded < 1), aes(x=X1, y=X2) ) +
  stat_density_2d(aes(fill = ..density..), geom = "raster", contour = FALSE) +
  scale_fill_distiller(palette= "Spectral", direction=1) +
  scale_x_continuous(limits = c(-10, 10)) +
  scale_y_continuous(limits = c(-10, 10))  +
  ggtitle("Less than 1 h")


ggplot(filter(umap_data,hours_rounded > 1 & hours_rounded < 2), aes(x=X1, y=X2) ) +
  stat_density_2d(aes(fill = ..density..), geom = "raster", contour = FALSE) +
  scale_fill_distiller(palette= "Spectral", direction=1) +
  scale_x_continuous(limits = c(-10, 10)) +
  scale_y_continuous(limits = c(-10, 10))  +
  ggtitle("2 h")


ggplot(filter(umap_data,hours_rounded < 2 & hours_rounded < 3), aes(x=X1, y=X2) ) +
  stat_density_2d(aes(fill = ..density..), geom = "raster", contour = FALSE) +
  scale_fill_distiller(palette= "Spectral", direction=1) +
  scale_x_continuous(limits = c(-10, 10)) +
  scale_y_continuous(limits = c(-10, 10))  +
  ggtitle("Less than 3 h")

ggplot(filter(umap_data,hours_rounded > 3 & hours_rounded < 4), aes(x=X1, y=X2) ) +
  stat_density_2d(aes(fill = ..density..), geom = "raster", contour = FALSE) +
  scale_fill_distiller(palette= "Spectral", direction=1) +
  scale_x_continuous(limits = c(-10, 10)) +
  scale_y_continuous(limits = c(-10, 10))  +
  ggtitle("Less than 4 h")

ggplot(filter(umap_data,hours_rounded > 4 & hours_rounded < 5), aes(x=X1, y=X2) ) +
  stat_density_2d(aes(fill = ..density..), geom = "raster", contour = FALSE) +
  scale_fill_distiller(palette= "Spectral", direction=1) +
  scale_x_continuous(limits = c(-10, 10)) +
  scale_y_continuous(limits = c(-10, 10))  +
  ggtitle("Less than 5 h")


ggplot(filter(umap_data,hours_rounded > 5 & hours_rounded < 6), aes(x=X1, y=X2) ) +
  stat_density_2d(aes(fill = ..density..), geom = "raster", contour = FALSE) +
  scale_fill_distiller(palette= "Spectral", direction=1) +
  scale_x_continuous(limits = c(-10, 10)) +
  scale_y_continuous(limits = c(-10, 10))  +
  ggtitle("Less than 6 h")


filter(umap_data,X2 > 6) %>%
  summarise(mean=mean(hours_rounded))

```