#show segment angle diagrams (aka "wave diagrams") next to skeleton of the same worm
```{r, include=FALSE}
#function to plot a skeleton
plot_skeleton <- function(data_plot){
  ggplot(data_plot, aes(x=X,y=Y,colour=angle))+
      geom_point(size=2) +
      geom_path(size=1) +
      # geom_point(aes(fill=angle_1)) +
      # transition_states(frame,transition_length = 0.1,state_length = 0.2) +
      # ease_aes('linear') + 
      #geom_text(aes(label=round(angle_1,3)),color="white",size=3,hjust=2, vjust=1)+
      geom_point(data=data_plot[which(data_plot$is_head == "YES"), ], aes(x=X, y=Y), shape=17, stroke=1, alpha=0.5,colour = "gold", size=4) +
      scale_x_continuous(limits=c(-10,70)) +
      scale_y_continuous(expan = c(0, 0),limits=c(70,-10),trans="reverse") +
      #facet_wrap(~ grouping,nrow=25,ncol=35, labeller = labeller(grouping=tracknames))+
      theme_black()+
      scale_color_gradient2(low = "cornflowerblue", mid = "white",
                         high = "brown2",midpoint=0,limits=c(-1,1),na.value="grey") +
      coord_equal() +
      theme(legend.position = "none",
            axis.title=element_blank(),
            axis.ticks=element_blank(),
            axis.text=element_blank(),
            axis.line=element_blank(),
            strip.text.x = element_text(colour = 'white',size=5))
      
}

#function to plot the wave diagram
plot_wave <- function(skeleton_wave_onetrack){
  ggplot(skeleton_wave_onetrack, aes(x=X,y=Y,fill=angle))+
    geom_raster(na.rm=TRUE)+
    scale_x_continuous(limits=c(min(skeleton_wave_onetrack$frame),max(skeleton_wave_onetrack$frame)))+
    scale_y_continuous(trans="reverse")+
    geom_vline(xintercept=f,linetype="longdash")+
    scale_fill_gradient2(low = "cornflowerblue",mid ="white",high = "brown2",midpoint=0,limits=c(-1,1),na.value="black") +
    theme_black()+
    theme(axis.text.y=element_blank(),
          axis.ticks.y=element_blank(),
          axis.line.y=element_blank(),
          legend.position = "top")+
    labs(x="frames",title=paste0("Timepoint: ", timepoint, ", ",unique(skeleton_wave_onetrack$TrackID)))+
    labs(y="head                                             tail")+
    theme(strip.text.x = element_text(size = 3))+
    labs(fill = "Intersegment angle (rad)")

}


timepoint <- 5
#only those that have a head structure within one timepoint of choice
skeleton_wave <- data_skeleton_with_headext %>%
  filter(tp == timepoint) %>%
  group_by(TrackID,frame) %>%
  filter(any(is_head=="YES")) %>%
  mutate(X=frame, Y=index) %>%
  mutate(grouping  = paste(tp, TrackID, sep="_"))

#present tracks with head
skeleton_wave %>%
  group_by(TrackID) %>%
  summarise(number_of_frames = length(unique(frame))) %>%
  arrange(desc(number_of_frames))

#
track <- "track_8"
#if you want a certain TrackID / timepoint
skeleton_wave_onetrack <- skeleton_wave %>%
      filter(tp == timepoint) %>%
      filter(TrackID == track)

skeleton_data_onetrack <- data_skeleton_with_headext %>%
      filter(tp == timepoint) %>%
      filter(TrackID == track)

min_frame <- min(skeleton_wave_onetrack %>% distinct(frame) %>% pull(frame))
max_frame <- max(skeleton_wave_onetrack %>% distinct(frame) %>% pull(frame))


for (f in min_frame:max_frame){
  data_plot <- skeleton_data_onetrack %>%
      filter(frame == f)
   
    p1<-plot_skeleton(data_plot)
    #print(p1)
    p2 <- plot_wave(skeleton_wave_onetrack)
    #print(p2)
    plot_grid(p2,p1,align=("v"),scale=c(1,0.8))+ theme(plot.background = element_rect(fill = "black"))
    ggsave(paste0(file.path(base_location,"ggplots"),"/","Wave_and_skeleton_","timepoint_",timepoint,"_",track,"_","frame_",f,".png"))
}


```
